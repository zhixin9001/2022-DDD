
DDD整体包含战略设计和战术设计两部分。战略设计过程会从业务视角出发，进行场景分析、领域建模，并划分领域边界、建立通用语言、确定限界上下文；战术设计则关注如何将模型转化为软件实现，涉及聚合根、实体、值对象、领域服务、应用服务等概念。所以战略设计重在把控方向、建立模型，战术设计重在软件实现，战略设计的好坏直接决定了DDD能否成功实施。所以除了关注DDD战术设计中用到的工具集、思想（比如四层架构、CQRS等）之外，更应该关注其战略设计。
下面以一个请假、考勤系统的案例来贯穿DDD的整个设计流程。系统的功能包括：
1. 请假：请假人可以提交请假单，根据请假人的身份、请假类型、请假天数进行校验，然后根据审批规则逐级提交给上次审批，审批通过后记录考勤，否则请假申请被拒绝；
2. 考勤：根据考勤规则，核销请假数据，对请假数据进行校验，输出考勤统计。
## 战略设计
战略设计的目的是根据用户旅程分析，找出领域对象和聚合根，对实体和值对象进行聚类组成聚合，划分限界上下文，建立领域模型。
战略设计采用事件风暴的方法，包括产品愿景和场景分析、领域建模、微服务拆分（如果要实现为微服务的话）等过程。
参与角色有领域专家、业务需求方、产品经理、架构师、开发经理、测试经理等。
### 产品愿景与场景分析
产品愿景是对产品顶层价值的设计，避免产品偏离方向。事件风暴中，大家讨论的维度可以围绕产品目标用户、核心价值、差异化竞争点。如果所涉及的系统目标和需求非常明确，那么这一步可以忽略。

场景分析则是从用户的视角出发，探索业务领域中的典型场景，明确涉及的场景、每个场景的用例。然后根据不同角色的场景分析，尽可能全面地梳理从前端操作到后端业务逻辑发生的所有操作、命令、领域事件以及外部依赖关系。

以请假和审批为例：请假的用户（角色）为请假人，审批的用户（角色）为审批人。
作为请假人，其用户旅程为：
- 登录系统，从鉴权中心获取请假人信息和权限数据，完成登录认证；
- 创建请假单：在请假页面选择请假类型、起始时间，录入请假休息，保存请假单；
- 修改请假单：查询请假单，修改、保存；
- 提交审批：将创建的请假单提交审批，系统会获取审批规则，并根据审批规则，从人员组织关系中获取审批人，给请假单分配审批人。

作为审批人，其用户旅程为：
- 登录系统，从鉴权中心获取请假人信息和权限数据，完成登录认证；
- 获取请假单：获取审批人名下的请假单；
- 审批：填写审批意见，批准或者拒绝；
- 逐级审批：审批人批准请假单后，系统会根据审批规则判断是否需要继续审批；
- 完成审批：系统发出领域事件：请假单已审批通过，后续会进一步执行邮件通知请假人、将请假数据发送到考勤的操作。

基于上述用户旅程进行场景分析，可以用不同的颜色来区分命令、业务流、事件、说明信息。
以业务流为主线，梳理出请假、审批的流程，然后基于业务流的每个步骤，梳理出触发这个步骤的命令，步骤完成后，会产生的事件。最终的参考结果如下图：
![场景分析](./场景分析.png)
这张图中，“根据审批规则查询审批人”需要依赖另一个上下文：人员组织关系，它的场景分析如下：
![场景分析1](./场景分析1.png)

### 领域建模
领域建模，会根据场景分析梳理出的事件、命令，找出实体、聚合根、限界上下文，最终经理领域模型。
如果说场景分析时一个发散的过程，各种角色各抒己见，大家一起分析用户旅程；那么领域建模就是一个收敛的过程。在这一步中，会由对DDD有足够了解的架构师、开发人员来主导完成。而且见仁见智，收敛的结果很可能因人而异，不过建模结果并没有绝对的好坏，只要能适应当前场景，而且模型还会在后续的只是循环、迭代中不断完善，最终不断逼近最优解。
分单个步骤：
1. 找出实体、值对象等领域对象；
2. 将这些领域对象形成聚合，确定聚合根；
3. 根据业务、语义边界等因素，定义限界上下文；

#### 找出领域对象
场景分析梳理出了事件、命令，接下来就要分析并找出产生这些命令、领域事件的实体和值对象。
下图为在请假、审批系统找出的实体、值对象（绿色）：
![找出实体](./找出实体.png)
#### 定义聚合

#### 定义限界上下文
### 微服务拆分
## 战术设计
### 分析微服务领域对象
### 设计微服务代码结构

**参考资料: 欧创新 《DDD实战课》**
